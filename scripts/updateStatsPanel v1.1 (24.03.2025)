/**
 * updateStatsPanel v1.1 (24.03.2025)
 * 
 * üìä –§—É–Ω–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Å—ã–ª–æ–∫
 * 
 * –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
 * - –°—á–∏—Ç–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–¥–æ–≤ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤)
 * - –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ —Å—Ä–µ–¥–∏ –Ω–∏—Ö 404, 403 –∏ 503
 * - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑ –∫–æ–ª–æ–Ω–∫–∏ E
 * - –í—ã–≤–æ–¥–∏—Ç –≤—Å—ë —ç—Ç–æ –≤ —è—á–µ–π–∫–∏ H1‚ÄìH5 –Ω–∞ –ª–∏—Å—Ç–µ "404 (–Ω–µ –º–µ–Ω—è—Ç—å!)"
 * - –†–∞—Å–∫—Ä–∞—à–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏: H2 ‚Äî –∫—Ä–∞—Å–Ω–∞—è (404), H3/H4 ‚Äî –∂—ë–ª—Ç–∞—è (403 –∏ 503)
 * 
 * –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π:
 * v1.0 ‚Äì 24.03.2025 ‚Äì –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–≤—Å–µ–≥–æ, 404, 403, –¥–∞—Ç–∞)
 * v1.1 ‚Äì 24.03.2025 ‚Äì –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–¥—Å—á—ë—Ç 503, —Ä–∞—Å–∫—Ä–∞—Å–∫–∞ —è—á–µ–µ–∫ H2‚ÄìH4
 */

function updateStatsPanel() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("404 (–Ω–µ –º–µ–Ω—è—Ç—å!)");
  const codes = sheet.getRange("D7:D").getValues().flat().filter(Boolean);

  const total = codes.length;
  const count404 = codes.filter(c => String(c) === "404").length;
  const count403 = codes.filter(c => String(c) === "403").length;
  const count503 = codes.filter(c => String(c) === "503").length;
  const lastDate = sheet.getRange("E7:E").getValues().flat().filter(Boolean).pop();

  sheet.getRange("H1").setValue(`–í—Å–µ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤: ${total}`).setBackground(null);
  sheet.getRange("H2").setValue(`404 –æ—à–∏–±–æ–∫: ${count404}`).setBackground("#f4cccc");
  sheet.getRange("H3").setValue(`403 –æ—à–∏–±–æ–∫: ${count403}`).setBackground("#fff2cc");
  sheet.getRange("H4").setValue(`503 –æ—à–∏–±–æ–∫: ${count503}`).setBackground("#fff2cc");
  sheet.getRange("H5").setValue(`–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞: ${lastDate || "-"}`).setBackground(null);
}
